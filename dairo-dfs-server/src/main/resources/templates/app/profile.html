<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="app/icd/css :: header('配置')"/>
</head>
<body>
<th:block th:include="app/icd/top-bar :: top-bar"/>

<div class="mx-3 mt-3 px-3 row g-0 rounded shadow bg-content-bar" style="line-height: 44px;">
    <div class="col-6 fs-5">配置</div>
    <div class="col-6 text-end" style="font-size: 0;">
    </div>
</div>
<div class="m-3 p-2 rounded shadow bg-content">
    <form id="form" action="/app/profile/update">
        <div class="row row-cols-1 row-cols-sm-2">
            <div class="col mt-2">
                <div class="row">
                    <label class="col-4 col-form-label text-end">文件大小限制</label>
                    <div class="col-8">
                        <div class="input-group" style="width: 160px;">
                            <input class="form-control" name="uploadMaxSize" autocomplete="off">
                            <span class="input-group-text">MB</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-sm-2">
            <div class="col mt-2">
                <div class="row">
                    <label class="col-4 col-form-label text-end">存储目录</label>
                    <div class="col-8">
                        <textarea class="form-control" name="folders"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-sm-2">
            <div class="col mt-2">
                <div class="row">
                    <label class="col-4 col-form-label text-end">记录同步日志</label>
                    <div class="col-8">
                        <select class="form-select w-auto" name="openSqlLog">
                            <option value="false">关闭</option>
                            <option value="true">开启</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-sm-2">
            <div class="col mt-2">
                <div class="row">
                    <label class="col-4 col-form-label text-end">只读模式</label>
                    <div class="col-8">
                        <select class="form-select w-auto" name="hasReadOnly">
                            <option value="false">关闭</option>
                            <option value="true">开启</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-sm-2">
            <div class="col mt-2">
                <div class="row">
                    <label class="col-4 col-form-label text-end">同步服务器URL</label>
                    <div class="col-8">
                        <textarea class="form-control" name="syncDomains"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-sm-2">
            <div class="col mt-2">
                <div class="row">
                    <label class="col-4 col-form-label text-end">同步票据</label>
                    <div class="col-8">
                        <div class="input-group">
                            <input class="form-control" name="token" disabled>
                            <button class="btn btn-primary" onclick="onMakeTokenClick()">生成</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-sm-2">
            <div class="col mt-2">
                <div class="row">
                    <label class="col-4 col-form-label text-end">本机同步URL</label>
                    <div class="col-8">
                        <input class="form-control" id="url" disabled>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-3 text-end">
            <button type="button" class="btn btn-primary" onclick="onSubmitClick()">提交</button>
        </div>
    </form>
</div>
<!--<th:block th:insert="app/icd/uc::content">
    <common-content>
        <th:block th:insert="app/icd/uc :: c-form('/app/profile/update')">
            <common-form>
                <th:block
                        th:insert="app/icd/uc::form-input(label='最大文件(Byte)', name='uploadMaxSize', btn='MB')"/>
                <th:block
                        th:insert="app/icd/uc::form-textarea(label='存储目录', name='folders')"/>
                <th:block
                        th:insert="app/icd/uc::form-textarea(label='同步域名', name='syncDomains')"/>
            </common-form>
            <common-form-btn>
                <button type="button" class="btn btn-primary" onclick="onSubmitClick()">提交</button>
            </common-form-btn>
        </th:block>
    </common-content>
</th:block>-->
<th:block th:include="app/icd/js :: js"/>
<script>
    $(function () {
        //$("form").initData()
        initData()
    })

    function initData() {
        $.http("/app/profile").success(data => {
            $("form").bindValue(data)
            const token = data.token
            let syncUrl = location.origin + "/sync/" + token
            $("#url").val(syncUrl)
        }).post()
    }

    function onSubmitClick() {
        $("form").ajaxByForm123().success(() => {
            alert("修改成功")
        }).post()
    }

    function onMakeTokenClick() {
        const rs = confirm("重置票据之后旧票据将无法使用，确定要重置票据？")
        if (!rs) {
            return
        }
        $.http("/app/profile/make_token").success(() => {

            //页面刷新
            history.go(0)
        }).post()
    }
</script>
</body>
</html>
